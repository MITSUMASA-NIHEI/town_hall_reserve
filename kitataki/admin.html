<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>確認者画面</title>

  <!-- ① 共通設定を最初に読む -->
  <script src="./config.js"></script>

  <!-- ② Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <!-- ③ CSS -->
  <link rel="stylesheet" href="./style.css" />
  <link rel="stylesheet" href="./admin.css" />
</head>

<body>

  <!-- ④ 認証チェック（画面表示前に実行） -->
  <script>
  (function(){
    const cfg = window.APP_CONFIG || {};
    const KEY = cfg.AUTH_STORAGE_KEY || "hb_admin_auth_v1";
    const TTL = Number(cfg.AUTH_TTL_HOURS || 8) * 60 * 60 * 1000;

    function isAuthed(){
      try{
        const raw = localStorage.getItem(KEY);
        if(!raw) return false;
        const obj = JSON.parse(raw);
        if(!obj.ok || !obj.exp) return false;
        if(Date.now() > obj.exp) return false;
        return true;
      }catch(e){
        return false;
      }
    }

    function setAuthed(){
      const exp = Date.now() + TTL;
      localStorage.setItem(KEY, JSON.stringify({ ok:true, exp }));
    }

    if (isAuthed()) return;

    const pass = prompt("管理者パスワードを入力してください");
    if (pass && pass === cfg.ADMIN_PASS){
      setAuthed();
      return;
    }

    alert("パスワードが違います");
    location.href = "./index.html";
  })();
  </script>

  <header class="hero">
    <h1>確認者画面</h1>
    <p>集会所の利用申請を確認します</p>
  </header>

  <!-- ナビゲーション -->
  <div class="topnav" style="text-align:center; margin:10px 0;">
    <button onclick="location.href='./index.html'">一般画面</button>
    <button onclick="location.href='./admin.html'">確認者</button>
    <button onclick="location.href='./annual.html'">年間行事</button>
    <button onclick="adminLogout()" style="margin-left:10px;">ログアウト</button>
  </div>

  <main class="wrap">
    <section class="card">
      <h2 style="text-align:center;">申請一覧</h2>

      <button class="btn btn-full" type="button" onclick="refresh()">更新</button>

      <div id="reqList" class="req-list"></div>

      <p class="note" style="margin-top:14px;">
        状態が「確認中」のものを中心に確認してください（承認済みは表示しません）。
      </p>
    </section>
  </main>

  <!-- ログアウト処理 -->
  <script>
    function adminLogout(){
      const cfg = window.APP_CONFIG || {};
      const KEY = cfg.AUTH_STORAGE_KEY || "hb_admin_auth_v1";
      localStorage.removeItem(KEY);
      alert("ログアウトしました");
      location.href = "./index.html";
    }
  </script>

  <!-- ⑤ adminロジック -->
  <script src="./admin.js"></script>

</body>
</html>